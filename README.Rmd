---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# noah

<!-- badges: start -->

[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental) [![CRAN status](https://www.r-pkg.org/badges/version/noah)](https://CRAN.R-project.org/package=noah) [![R build status](https://github.com/Teebusch/noah/workflows/R-CMD-check/badge.svg)](https://github.com/Teebusch/noah/actions) [![Codecov test coverage](https://codecov.io/gh/Teebusch/noah/branch/master/graph/badge.svg)](https://codecov.io/gh/Teebusch/noah?branch=master)

<!-- badges: end -->

`noah` (**no** **a**nimals were **h**armed) generates pseudonyms that are 
delightful and easy to remember. 
Instead of cryptic alphanumeric IDs, it generates anonymous animals like the
*Likeable Leech* and the *Proud Chickadee*.

## Installation

You can install the development version of `noah` from [Github](/https://github.com/teebusch/noah) with:

```{r eval=FALSE}
# install.packages("remotes")
remotes::install_github("teebusch/noah")
```

## Usage

```{r include=FALSE}
set.seed(122020)
```

### Generating pseudonyms

A quick way to create pseudonyms with `noah` is to use the `pseudonymize()`
function. It will generate pseudonyms for every element in a vector, so if you 
need 100 pseudonyms, just call `pseudonymize(1:100)`. 
Note that repeated elements will receive the same pseudonym:

```{r}
library(noah)

pseudonymize(rep(1:4, times = 2))
```

`pseudonymize()` accepts any number of input vectors as arguments, as long as 
they are the same length. It will treat the elements in the same position as 
being from the same subject. 

```{r}
pseudonymize(
  c("üê∞", "üê∞", "üê∞"), 
  c("ü•ï", "ü•ï", "üç∞")
)
```

### Adding pseudonyms to a data frame

Often we may want to add a column with pseudonyms to a data frame, using one or 
more columns as identifiers. We can do this with `pseudonymize()` and
`dplyr::mutate()`.

In this example we use the diabetic retinopathy dataset from the `survival` 
package and add a new column with a pseudonym for each unique `id`:

```{r example-pseudonymize, warning=FALSE, message=FALSE}
library(dplyr)
diabetic <- as_tibble(survival::diabetic)

diabetic %>% 
  mutate(pseudonym = pseudonymize(id)) %>% 
  relocate(pseudonym)
```


### Keeping track of pseudonyms

Internally, `pseudonymize()` uses an object of class `Ark` that acts like a 
pseudonym dictionary and keeps track of pseudonyms that have been used.
Normally, a new `Ark` is created for each call of the `pseudonymize()` function.
However, we can use an `Ark` to ensure that the same input is always assigned 
the same pseudonym across multiple data sets:

```{r example-ark}
ark <- Ark$new()

# split dataset into left and right eye and pseudonymize separately
diabetic_left <- diabetic %>% 
  filter(eye == "left") %>% 
  mutate(pseudonym = pseudonymize(id, .ark = ark))

diabetic_right <- diabetic %>% 
  filter(eye == "right") %>% 
  mutate(pseudonym = pseudonymize(id, .ark = ark))

# reunite the data sets again
bind_rows(diabetic_left, diabetic_right) %>% 
  relocate(pseudonym) %>% 
  arrange(id)
```
